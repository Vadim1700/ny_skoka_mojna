const translations = {
  ru: {
    getSignal: '–ü–æ–ª—É—á–∏—Ç—å —Å–∏–≥–Ω–∞–ª',
    signalTitleForex: '–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –§–æ—Ä–µ–∫—Å',
    signalTitleOtx: '–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ OTC',
    forexClosed: '–§–æ—Ä–µ–∫—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –≤—ã—Ö–æ–¥–Ω—ã–º',
    analyzing: '–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ä—ã–Ω–æ–∫...',
    analyzingData: '–ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...',
    nextSignal: '–°–ª–µ–¥—É—é—â–∏–π —Å–∏–≥–Ω–∞–ª –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑',
    timeLabel: '–í—Ä–µ–º—è',
    pairLabel: '–ü–∞—Ä–∞',
    actionLabel: '–î–µ–π—Å—Ç–≤–∏–µ',
    marketBlocked: '‚ö†Ô∏è –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Ä—ã–Ω–∫–∞–º–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω',
    expiryLabel: '–≠–∫—Å–ø–∏—Ä–∞—Ü–∏—è',
    confidenceLabel: '–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å',
    reasonLabel: '–ü—Ä–∏—á–∏–Ω–∞',
    buy: '–ü–æ–∫—É–ø–∫–∞',
    sell: '–ü—Ä–æ–¥–∞–∂–∞',
    buyReasons: [
      '–ó–æ–ª–æ—Ç–æ–π –∫—Ä–µ—Å—Ç ‚Äî —Å–∏–≥–Ω–∞–ª –Ω–∞—á–∞–ª–∞ –≤–æ—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–µ–Ω–¥–∞.',
      '–ü—Ä–æ–±–æ–π —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è —Å –æ–±—ä—ë–º–æ–º ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ–µ –Ω–∞—á–∞–ª–æ —Ä–æ—Å—Ç–∞.'
    ],
    sellReasons: [
      '–ü—Ä–æ–±–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ–µ –¥–∞–ª—å–Ω–µ–π—à–µ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ.',
      '–ú–µ–¥–≤–µ–∂—å–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ ‚Äî —Å–∏–≥–Ω–∞–ª –æ—Å–ª–∞–±–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞.',
      '–§–∏–≥—É—Ä–∞ "–≥–æ–ª–æ–≤–∞ –∏ –ø–ª–µ—á–∏" ‚Äî –ø—Ä–µ–¥–≤–µ—Å—Ç–Ω–∏–∫ –ø–∞–¥–µ–Ω–∏—è.'
    ]
  },
  en: {
    getSignal: 'Get Signal',
    signalTitleForex: 'Getting Forex Signal',
    signalTitleOtx: 'Getting OTC Signal',
    forexClosed: 'Forex is closed on weekends',
    analyzing: 'Analyzing market...',
    marketBlocked: '‚ö†Ô∏è Market switching is temporarily disabled',
    analyzingData: 'Analyzing market data...',
    nextSignal: 'Next signal available in',
    timeLabel: 'Time',
    pairLabel: 'Pair',
    actionLabel: 'Action',
    expiryLabel: 'Expiry',
    confidenceLabel: 'Confidence',
    reasonLabel: 'Reason',
    buy: 'Buy',
    sell: 'Sell',
    buyReasons: [
      'Golden cross ‚Äî signal of an upward trend.',
      'Resistance breakout with volume ‚Äî possible start of growth.'
    ],
    sellReasons: [
      'Support breakout ‚Äî possible further decline.',
      'Bearish divergence ‚Äî trend weakening signal.',
      '"Head and shoulders" pattern ‚Äî precursor to a drop.'
    ]
  },
  in: {
    getSignal: '‡§∏‡§ø‡§ó‡•ç‡§®‡§≤ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç',
    signalTitleForex: '‡§´‡•â‡§∞‡•á‡§ï‡•ç‡§∏ ‡§∏‡§ø‡§ó‡•ç‡§®‡§≤ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç',
    signalTitleOtx: 'OTC ‡§∏‡§ø‡§ó‡•ç‡§®‡§≤ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç',
    forexClosed: '‡§´‡•â‡§∞‡•á‡§ï‡•ç‡§∏ ‡§∏‡§™‡•ç‡§§‡§æ‡§π‡§æ‡§Ç‡§§ ‡§Æ‡•á‡§Ç ‡§¨‡§Ç‡§¶ ‡§∞‡§π‡§§‡§æ ‡§π‡•à',
    analyzing: '‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...',
    analyzingData: '‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§°‡•á‡§ü‡§æ ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£...',
    marketBlocked: '‚ö†Ô∏è ‡§Æ‡§æ‡§∞‡•ç‡§ï‡•á‡§ü ‡§∏‡•ç‡§µ‡§ø‡§ö‡§ø‡§Ç‡§ó ‡§Ö‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§¨‡§Ç‡§¶ ‡§π‡•à',
    nextSignal: '‡§Ö‡§ó‡§≤‡§æ ‡§∏‡§ø‡§ó‡•ç‡§®‡§≤ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à',
    timeLabel: '‡§∏‡§Æ‡§Ø',
    pairLabel: '‡§™‡•á‡§Ø‡§∞',
    actionLabel: '‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ',
    expiryLabel: '‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡§ø',
    confidenceLabel: '‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§∏‡•ç‡§§‡§∞',
    reasonLabel: '‡§ï‡§æ‡§∞‡§£',
    buy: '‡§ñ‡§∞‡•Ä‡§¶‡•á‡§Ç',
    sell: '‡§¨‡•á‡§ö‡•á‡§Ç',
    buyReasons: [
      '‡§ó‡•ã‡§≤‡•ç‡§°‡§® ‡§ï‡•ç‡§∞‡•â‡§∏ ‚Äî ‡§ä‡§™‡§∞ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§µ‡•É‡§§‡•ç‡§§‡§ø ‡§ï‡§æ ‡§∏‡§Ç‡§ï‡•á‡§§‡•§',
      '‡§µ‡•â‡§≤‡•ç‡§Ø‡•Ç‡§Æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡•ç‡§∞‡§§‡§ø‡§∞‡•ã‡§ß ‡§¨‡•ç‡§∞‡•á‡§ï‡§Ü‡§â‡§ü ‚Äî ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø ‡§ï‡•Ä ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§‡•§'
    ],
    sellReasons: [
      '‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§¨‡•ç‡§∞‡•á‡§ï‡§Ü‡§â‡§ü ‚Äî ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§ó‡§ø‡§∞‡§æ‡§µ‡§ü‡•§',
      '‡§¨‡•á‡§Ø‡§∞‡§ø‡§∂ ‡§°‡§æ‡§á‡§µ‡§∞‡•ç‡§ú‡•á‡§Ç‡§∏ ‚Äî ‡§™‡•ç‡§∞‡§µ‡•É‡§§‡•ç‡§§‡§ø ‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡•§',
      '"‡§π‡•á‡§° ‡§è‡§Ç‡§° ‡§∂‡•ã‡§≤‡•ç‡§°‡§∞" ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‚Äî ‡§ó‡§ø‡§∞‡§æ‡§µ‡§ü ‡§ï‡§æ ‡§∏‡§Ç‡§ï‡•á‡§§‡•§'
    ]
  },
  uz: {
    getSignal: 'Signalni olish',
    signalTitleForex: 'Forex signali olinmoqda',
    signalTitleOtx: 'OTC signali olinmoqda',
    forexClosed: 'Forex dam olish kunlari yopiq',
    analyzing: 'Bozor tahlil qilinmoqda...',
    analyzingData: 'Bozor ma ºlumotlari tahlil qilinmoqda...',
    marketBlocked: '‚ö†Ô∏è Bozorni almashtirish vaqtincha bloklangan',
    nextSignal: 'Keyingi signal mavjud:',
    timeLabel: 'Vaqt',
    pairLabel: 'Juftlik',
    actionLabel: 'Harakat',
    expiryLabel: 'Muddati',
    confidenceLabel: 'Ishonch darajasi',
    reasonLabel: 'Sabab',
    buy: 'Sotib olish',
    sell: 'Sotish',
    buyReasons: [
      'Oltin kesish ‚Äî o‚Äòsuvchi trend belgisi.',
      'Hajm bilan qarshilik buzilishi ‚Äî o‚Äòsish boshlanishi mumkin.'
    ],
    sellReasons: [
      'Qo‚Äòllab-quvvatlash buzilishi ‚Äî pasayish davom etishi mumkin.',
      'Ayvon divergentsiyasi ‚Äî trend zaiflashmoqda.',
      '"Bosh va yelkalar" shakli ‚Äî pasayish belgisi.'
    ]
  }
};


const app = document.getElementById('app');
const lightBtn = document.getElementById('light-btn');
const darkBtn = document.getElementById('dark-btn');
let isGeneratingSignal = false;
let currentLang = 'ru';
let lastSignal = {
  actionKey: null,
  reasonIndex: null,
  marketType: null
};



lightBtn.addEventListener('click', () => {
  app.classList.remove('theme-dark');
  app.classList.add('theme-light');
});

darkBtn.addEventListener('click', () => {
  app.classList.remove('theme-light');
  app.classList.add('theme-dark');
});

const languageSelect = document.getElementById('language-select');
languageSelect.addEventListener('change', (e) => {
  const lang = e.target.value;
  console.log('–í—ã–±—Ä–∞–Ω —è–∑—ã–∫:', lang);
});


const selected = document.getElementById('selected-language');
const options = document.getElementById('language-options');

// üîÑ –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ —Å–ø–∏—Å–∫–∞
selected.addEventListener('click', () => {
  options.style.display = options.style.display === 'block' ? 'none' : 'block';
});

// üéØ –í—ã–±–æ—Ä —è–∑—ã–∫–∞
document.querySelectorAll('.language-option').forEach(option => {
  option.addEventListener('click', () => {
    const lang = option.getAttribute('data-lang');
    currentLang = lang;

    const imgSrc = option.querySelector('img').src;
    const text = option.querySelector('span').textContent;
    selected.innerHTML = `<img src="${imgSrc}" alt="${text}" /><span>${text}</span>`;
    options.style.display = 'none';

    console.log('–í—ã–±—Ä–∞–Ω —è–∑—ã–∫:', lang);
    updateInterfaceLanguage();
  });
});


// ‚úÖ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–±—Ä–∞–Ω —Ä—É—Å—Å–∫–∏–π (—É–∂–µ –æ—Ç–æ–±—Ä–∞–∂—ë–Ω –≤ HTML)


const forexBtn = document.getElementById('forex-btn');
const forexWarning = document.getElementById('forex-warning');
const signalTitle = document.getElementById('signal-title');

// üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
const today = new Date();
const day = today.getDay(); // 0 = Sunday, 6 = Saturday

forexBtn.addEventListener('click', () => {
  if (isGeneratingSignal) {
    showMarketWarning();
    return;
  }

  lastSignal.marketType = 'forex'; // ‚úÖ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–∏–ø —Ä—ã–Ω–∫–∞

  const day = new Date().getDay();
  if (day === 0 || day === 6) {
    forexWarning.style.display = 'block';
    signalTitle.textContent = translations[currentLang]['forexClosed'];
  } else {
    forexWarning.style.display = 'none';
    signalTitle.textContent = translations[currentLang]['signalTitleForex']; // ‚úÖ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –§–æ—Ä–µ–∫—Å
  }

  updateExpiryOptions('forex'); // –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —Ä–∞–∑–Ω—ã–µ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏
});


document.getElementById('otx-btn').addEventListener('click', () => {
  if (isGeneratingSignal) {
    showMarketWarning();
    return;
  }

  // ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø —Ä—ã–Ω–∫–∞
  lastSignal.marketType = 'otx';

  // ‚úÖ –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –§–æ—Ä–µ–∫—Å–µ
  document.getElementById('forex-warning').style.display = 'none';

  // ‚úÖ –ü–µ—Ä–µ–≤–æ–¥–∏–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
  document.getElementById('signal-title').textContent = translations[currentLang]['signalTitleOtx'];

  // ‚úÖ –û–±–Ω–æ–≤–ª—è–µ–º —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
  updateExpiryOptions?.('otx');
});


window.onload = () => {
  document.getElementById('otx-btn').click(); // –∑–∞–ø—É—Å–∫–∞–µ–º OTX –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
};


document.getElementById('get-signal-btn').addEventListener('click', () => {
  isGeneratingSignal = true;

  const getSignalBtn = document.getElementById('get-signal-btn');
  const loadingBlock = document.getElementById('signal-loading');
  const loadingText = document.getElementById('loading-text');
  const resultBlock = document.getElementById('signal-result');
  const countdownText = document.getElementById('countdown-text');
  const signalTitle = document.getElementById('signal-title');
  const t = translations[currentLang];

  resultBlock.style.display = 'none';
  loadingBlock.style.display = 'block';
  loadingText.textContent = t.analyzing;

  setTimeout(() => {
    loadingText.textContent = t.analyzingData;
  }, 1500);

  setTimeout(() => {
    loadingBlock.style.display = 'none';
    resultBlock.style.display = 'block';
    isGeneratingSignal = false;

    const pair = document.getElementById('pair-select').value;
    const expiry = document.getElementById('expiry-select').value;
    const now = new Date();
    const time = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');

    const actions = ['buy', 'sell'];
    const actionKey = actions[Math.floor(Math.random() * actions.length)];
    const reasonIndex = Math.floor(Math.random() * t[actionKey + 'Reasons'].length);

    lastSignal.actionKey = actionKey;
    lastSignal.reasonIndex = reasonIndex;

    const actionText = t[actionKey];
    const reason = t[actionKey + 'Reasons'][reasonIndex];
    const confidence = Math.floor(70 + Math.random() * 20) + '%';

    const iconSrc = actionKey === 'buy' ? 'IMG/up.png' : 'IMG/down.png';
    const actionClass = actionKey;

    // üîÑ –ü–µ—Ä–µ–≤–æ–¥ –º–µ—Ç–æ–∫
    document.getElementById('label-time').textContent = t.timeLabel;
    document.getElementById('label-pair').textContent = t.pairLabel;
    document.getElementById('label-action').textContent = t.actionLabel;
    document.getElementById('label-expiry').textContent = t.expiryLabel;
    document.getElementById('label-confidence').textContent = t.confidenceLabel;
    document.getElementById('label-reason').textContent = t.reasonLabel;

    // üßæ –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    document.getElementById('signal-time').textContent = time;
    document.getElementById('signal-pair').textContent = pair;
    document.getElementById('signal-action').innerHTML = `
      <img src="${iconSrc}" alt="${actionText}" class="action-icon" />
      <span class="${actionClass}">${actionText}</span>
      <img src="${iconSrc}" alt="${actionText}" class="action-icon" />
    `;
    document.getElementById('signal-expiry').textContent = expiry;
    document.getElementById('signal-confidence').textContent = confidence;
    document.getElementById('signal-reason-text').textContent = reason;

    // ‚è±Ô∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ä—ã–Ω–∫–∞ –∏ –≤—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    const marketType = signalTitle.textContent.includes(t.signalTitleOtx) ? 'otx' : 'forex';
    let countdown = marketType === 'otx' ? 15 : 30;

    getSignalBtn.disabled = true;
    getSignalBtn.classList.add('disabled');
    countdownText.textContent = `${t.nextSignal} ${countdown}`;

    const countdownInterval = setInterval(() => {
      countdown--;
      countdownText.textContent = `${t.nextSignal} ${countdown} —Å–µ–∫`;
      if (countdown <= 0) {
        clearInterval(countdownInterval);
        countdownText.textContent = '';
        getSignalBtn.disabled = false;
        getSignalBtn.classList.remove('disabled');
      }
    }, 1000);
  }, 3000);
});



const expiryOptions = {
  otx: ['5 —Å–µ–∫', '15 —Å–µ–∫', '30 —Å–µ–∫', '1 –º–∏–Ω—É—Ç–∞', '3 –º–∏–Ω—É—Ç—ã', '5 –º–∏–Ω—É—Ç', '30 –º–∏–Ω—É—Ç'],
  forex: ['1 –º–∏–Ω—É—Ç–∞', '3 –º–∏–Ω—É—Ç—ã', '5 –º–∏–Ω—É—Ç', '30 –º–∏–Ω—É—Ç']
};



function updateExpiryOptions(marketType) {
  const expirySelect = document.getElementById('expiry-select');
  expirySelect.innerHTML = ''; // –æ—á–∏—â–∞–µ–º

  expiryOptions[marketType].forEach(label => {
    const option = document.createElement('option');
    option.value = label;
    option.textContent = label;
    expirySelect.appendChild(option);
  });
}


function updateInterfaceLanguage() {
  const t = translations[currentLang];

  // üîò –ö–Ω–æ–ø–∫–∞ –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫
  document.getElementById('get-signal-btn').textContent = t.getSignal;
  document.getElementById('signal-title').textContent =
    lastSignal.marketType === 'otx' ? t.signalTitleOtx : t.signalTitleForex;

  // üè∑Ô∏è –ú–µ—Ç–∫–∏ —Ñ–æ—Ä–º—ã
  document.getElementById('label-pair').textContent = t.pairLabel;
  document.getElementById('label-expiry').textContent = t.expiryLabel;

  // üè∑Ô∏è –ú–µ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  document.getElementById('label-time').textContent = t.timeLabel;
  document.getElementById('label-pair-result').textContent = t.pairLabel + ':';
  document.getElementById('label-action').textContent = t.actionLabel + ':';
  document.getElementById('label-expiry-result').textContent = t.expiryLabel + ':';
  document.getElementById('label-confidence').textContent = t.confidenceLabel + ':';
  document.getElementById('label-reason').textContent = t.reasonLabel;

  // ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
  document.getElementById('forex-warning-text').textContent = t.forexClosed;
  document.getElementById('market-warning-text').textContent = t.marketBlocked;


  // üîÅ –ü–µ—Ä–µ–≤–æ–¥ –¥–µ–π—Å—Ç–≤–∏—è –∏ –ø—Ä–∏—á–∏–Ω—ã, –µ—Å–ª–∏ —Å–∏–≥–Ω–∞–ª —É–∂–µ –±—ã–ª
  if (lastSignal.actionKey !== null && lastSignal.reasonIndex !== null) {
    const actionText = t[lastSignal.actionKey];
    const reason = t[lastSignal.actionKey + 'Reasons'][lastSignal.reasonIndex];
    const iconSrc = lastSignal.actionKey === 'buy' ? 'IMG/up.png' : 'IMG/down.png';
    const actionClass = lastSignal.actionKey;

    document.getElementById('signal-action').innerHTML = `
      <img src="${iconSrc}" alt="${actionText}" class="action-icon" />
      <span class="${actionClass}">${actionText}</span>
      <img src="${iconSrc}" alt="${actionText}" class="action-icon" />
    `;
    document.getElementById('signal-reason-text').textContent = reason;
  }
}
